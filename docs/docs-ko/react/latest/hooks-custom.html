<!DOCTYPE html><html><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><title>构建自定义 Hooks</title><meta charSet="utf-8"/><meta content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, minimal-ui" name="viewport"/><meta content="如何使用ReScript &amp; React构建你自己的hooks" name="description"/><meta content="" name="keywords"/><link href="/static/favicon/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/><link href="/static/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/><link href="/static/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/><link href="/static/favicon/site.webmanifest" rel="manifest"/><meta content="ReScript Documentation" property="og:site_name"/><meta content="en_US" property="og:locale"/><meta content="构建自定义 Hooks" property="og:title"/><meta content="如何使用ReScript &amp; React构建你自己的hooks" property="og:description"/><meta content="构建自定义 Hooks" name="twitter:title"/><meta content="如何使用ReScript &amp; React构建你自己的hooks" name="twitter:description"/><meta content="@reasonml" name="twitter:site"/><meta content="@ReasonAssoc" name="twitter:creator"/><meta content="image/jpeg" property="og:image:type"/><meta content="summary_large_image" name="twitter:card"/><link title="ReScript Blog" href="/blog/feed.xml" rel="alternate" type="application/rss+xml"/><meta name="next-head-count" content="20"/><link rel="preload" href="/_next/static/css/2b269719632b344a478b.css" as="style"/><link rel="stylesheet" href="/_next/static/css/2b269719632b344a478b.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-c49b9de92a7202ac2146.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework-23118dcc1b886e5b49be.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-82e7c4d3c08582bd58e0.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-9e9d9ab67b4ceb7ec93b.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/docs-ko/react/latest/hooks-custom-06c465761882a020ea13.js" as="script"/></head><body><div id="__next"><div class="mt-4 xs:mt-16"><div class="text-gray-80"><nav class="fixed top-0 z-50 px-4 flex xs:justify-center w-full h-16 bg-gray-90 shadow text-white-80 text-14" id="header" style="min-width:20rem"><div class="flex justify-between items-center h-full w-full max-w-1280"><div class="h-8 w-8 lg:h-10 lg:w-32"><a class="block hover:cursor-pointer w-full h-full flex justify-center items-center font-bold" href="/"><img class="lg:hidden" src="/static/nav-logo@2x.png"/><img class="hidden lg:block" src="/static/nav-logo-full@2x.png"/></a></div><div class="flex items-center xs:justify-between w-full bg-gray-90 sm:h-auto sm:relative"><div class="flex ml-10 space-x-5 w-full max-w-320" style="max-width:26rem"><div class="relative"><div class="flex items-center"><button class="no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px border-none flex items-center hover:cursor-pointer " tabindex="0"><span class="">文档</span></button></div><div class="hidden fixed left-0 overflow-y-scroll overflow-x-hidden border-gray-80 border-gray-40 min-w-320 w-full h-full bg-white sm:overflow-y-auto sm:bg-transparent sm:h-auto sm:justify-center sm:rounded-bl-xl sm:rounded-br-xl sm:shadow" style="margin-top:1rem"><div class="w-full"><div class="relative w-full bg-white pb-32 min-h-full sm:pb-0 text-gray-60 text-14 rounded-bl-xl rounded-br-xl"><div class="flex justify-center"><div class="w-full sm:grid sm:grid-cols-3 max-w-1280"><div class="flex px-4 sm:justify-center border-r border-gray-10 pt-8 pb-10"><div><div class="text-12 font-medium text-gray-100 tracking-wide uppercase subpixel-antialiased">快速跳转</div><div><ul class="space-y-2 ml-2 mt-6"><li><span class="text-fire mr-2">-</span><a class="hover:text-fire-50" href="/docs-cn/manual/latest/introduction">概览</a></li><li><span class="text-fire mr-2">-</span><a class="hover:text-fire-50" href="/docs-cn/manual/latest/overview">语言特性</a></li><li><span class="text-fire mr-2">-</span><a class="hover:text-fire-50" href="/docs-cn/manual/latest/embed-raw-javascript">与 JS 互操作</a></li><li><span class="text-fire mr-2">-</span><a class="hover:text-fire-50" href="/docs-cn/manual/latest/build-overview">构建系统</a></li></ul></div></div></div><div class="flex px-4 sm:h-full sm:justify-center border-r border-gray-10 pt-8"><div class="w-full pb-16" style="max-width:19.625rem"><div class="text-12 font-medium text-gray-100 tracking-wide uppercase subpixel-antialiased">Documentation</div><div><div class="mt-6"><a class="" href="/docs-cn/manual/latest/introduction"><div class="hover:bg-gray-5 hover:shadow hover:-mx-8 hover:px-8 hover:cursor-pointer active:bg-gray-20 py-4 flex space-x-4 items-start rounded-xl"><img style="width:2.1875rem" src="/static/ic_manual@2x.png"/><div><div class="flex items-center text-16 font-medium text-gray-80"><span>语言手册</span></div><div class="block text-14 text-gray-60 text-gray-60">所有的语言特性的参考指南</div></div></div></a><a class="" href="/docs/react/latest/introduction"><div class="hover:bg-gray-5 hover:shadow hover:-mx-8 hover:px-8 hover:cursor-pointer active:bg-gray-20 py-4 flex space-x-4 items-start rounded-xl"><img style="width:2.1875rem" src="/static/ic_rescript_react@2x.png"/><div><div class="flex items-center text-16 font-medium text-gray-80"><span>ReScript &amp; React</span></div><div class="block text-14 text-gray-60 text-gray-60">ReactJS 的一等公民绑定</div></div></div></a><a class="" href="/docs/gentype/latest/introduction"><div class="hover:bg-gray-5 hover:shadow hover:-mx-8 hover:px-8 hover:cursor-pointer active:bg-gray-20 py-4 flex space-x-4 items-start rounded-xl"><img style="width:2.1875rem" src="/static/ic_gentype@2x.png"/><div><div class="flex items-center text-16 font-medium text-gray-80"><span>GenType</span></div><div class="block text-14 text-gray-60 text-gray-60">无缝衔接 TypeScript &amp; Flow 集成</div></div></div></a><a class="" href="https://github.com/reason-association/reanalyze" rel="noopener noreferrer"><div class="hover:bg-gray-5 hover:shadow hover:-mx-8 hover:px-8 hover:cursor-pointer active:bg-gray-20 py-4 flex space-x-4 items-start rounded-xl"><img style="width:2.1875rem" src="/static/ic_reanalyze@2x.png"/><div><div class="flex items-center text-16 font-medium text-gray-80"><span>Reanalyze</span><svg class="stroke-current inline-block ml-2 w-4 h-4" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></div><div class="block text-14 text-gray-60 text-gray-60">死代码消除 &amp; 停机分析</div></div></div></a></div></div></div></div><div class="flex px-4 sm:h-full sm:justify-center pb-12 pt-8 pb-10"><div class="w-full" style="max-width:19.625rem"><div class="text-12 font-medium text-gray-100 tracking-wide uppercase subpixel-antialiased">Exploration</div><div class="mt-6"><a class="" href="/syntax-lookup"><div class="hover:bg-gray-5 hover:shadow hover:-mx-8 hover:px-8 hover:cursor-pointer active:bg-gray-20 py-4 flex space-x-4 items-start rounded-xl"><div class="-mr-2 flex w-6 h-6 justify-center items-center"><img class="w-4 h-4" src="/static/ic_search.svg"/></div><div><div class="flex items-center text-16 font-medium text-gray-80"><span>语法查找</span></div><div class="block text-14 text-gray-60 text-gray-60">探索所有语法结构</div></div></div></a></div></div></div></div></div><img class="hidden xl:block absolute bottom-0 right-0" style="max-width:27.8rem" src="/static/illu_index_rescript@2x.png"/></div></div></div></div><a class="no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="/docs-cn/manual/latest/api">API</a><a class="hidden xs:block no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="/try">工作台</a></div><div class="hidden md:flex items-center"><div class="hidden sm:block mr-6"><div class=" bg-gray-100 border border-gray-70 hover:text-white hover:cursor-pointer flex justify-center p-2 px-3 rounded-lg"><input type="text" class="transition-all ease-in-out duration-150 text-white bg-gray-100 border-none focus:outline-none w-0" id="docsearch"/><svg class="stroke-current text-gray-60 w-5 h-5" height="19.203" width="19.203" viewBox="0 0 19.203 19.203"><g fill="none" stroke-linecap="round" stroke-width="2px" transform="translate(-2 -2)"><path d="M6.479,0A6.479,6.479,0,1,1,0,6.479,6.479,6.479,0,0,1,6.479,0Z" transform="translate(3 3)"></path><line stroke-linejoin="round" transform="translate(14.055 14.055)" x1="5.734" y1="5.734"></line></g></svg></div></div><a class="mr-5 no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="https://github.com/reason-association/rescript-lang.org#rescript-langorg" rel="noopener noreferrer"><svg class="fill-current w-6 h-6 opacity-50 hover:opacity-100" height="17.79" width="18.236" viewBox="0 0 18.236 17.79"><g transform="translate(8 -5.365)"><path d="M17.013,9.906a9.078,9.078,0,0,0-3.318-3.318A8.918,8.918,0,0,0,9.118,5.365,8.919,8.919,0,0,0,4.541,6.588,9.077,9.077,0,0,0,1.223,9.906,8.919,8.919,0,0,0,0,14.483a8.861,8.861,0,0,0,1.739,5.36,8.93,8.93,0,0,0,4.493,3.294.531.531,0,0,0,.475-.083.464.464,0,0,0,.154-.356q0-.036-.006-.641T6.85,21l-.273.047a3.484,3.484,0,0,1-.659.042,5.02,5.02,0,0,1-.825-.083,1.844,1.844,0,0,1-.8-.356,1.506,1.506,0,0,1-.522-.73l-.119-.273a2.966,2.966,0,0,0-.374-.605,1.432,1.432,0,0,0-.516-.451l-.083-.06a.871.871,0,0,1-.154-.143.651.651,0,0,1-.107-.166q-.036-.083.059-.137a.77.77,0,0,1,.344-.053l.237.035a1.733,1.733,0,0,1,.588.285,1.916,1.916,0,0,1,.576.617,2.093,2.093,0,0,0,.659.742,1.4,1.4,0,0,0,.778.255,3.376,3.376,0,0,0,.677-.059,2.362,2.362,0,0,0,.534-.178,1.924,1.924,0,0,1,.582-1.223,8.129,8.129,0,0,1-1.217-.214,4.845,4.845,0,0,1-1.116-.463,3.2,3.2,0,0,1-.956-.8,3.822,3.822,0,0,1-.623-1.247A5.928,5.928,0,0,1,3.3,14.007a3.463,3.463,0,0,1,.938-2.446A3.192,3.192,0,0,1,4.321,9.14a1.664,1.664,0,0,1,1.021.16,7.138,7.138,0,0,1,.991.457q.315.19.5.321a8.574,8.574,0,0,1,4.559,0l.451-.285a6.389,6.389,0,0,1,1.092-.522,1.556,1.556,0,0,1,.962-.13A3.161,3.161,0,0,1,14,11.562a3.463,3.463,0,0,1,.938,2.446,5.994,5.994,0,0,1-.243,1.787,3.674,3.674,0,0,1-.629,1.247,3.319,3.319,0,0,1-.962.789,4.855,4.855,0,0,1-1.116.463,8.121,8.121,0,0,1-1.217.214,2.115,2.115,0,0,1,.617,1.686v2.5a.473.473,0,0,0,.149.356.516.516,0,0,0,.469.083A8.929,8.929,0,0,0,16.5,19.842a8.863,8.863,0,0,0,1.739-5.36A8.926,8.926,0,0,0,17.013,9.906Z" transform="translate(-8 0)"></path></g></svg></a><a class="mr-5 no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="https://twitter.com/rescriptlang" rel="noopener noreferrer"><svg class="fill-current w-6 h-6 opacity-50 hover:opacity-100" viewBox="0 0 15.53 12.71"><path d="M5.794,12.711a13.325,13.325,0,0,1-2.058-.163A9.659,9.659,0,0,1,.92,11.523L0,11.02l1-.328c1.089-.358,1.751-.58,2.571-.928A3.421,3.421,0,0,1,1.809,7.726l-.232-.7.19.029a3.456,3.456,0,0,1-.433-.534A3.276,3.276,0,0,1,.779,4.57l.044-.614L1.19,4.1a3.437,3.437,0,0,1-.333-.934A3.552,3.552,0,0,1,1.235.774l.32-.588L1.984.7A7.883,7.883,0,0,0,7.091,3.575a3.054,3.054,0,0,1,.185-1.623A3.038,3.038,0,0,1,8.511.536,3.71,3.71,0,0,1,10.664.008a3.439,3.439,0,0,1,2.114.872,7.1,7.1,0,0,0,.774-.258c.17-.064.362-.136.6-.219L15.042.1l-.579,1.652.119-.008L15.53,1.7l-.56.765c-.032.044-.04.056-.052.073-.045.068-.1.153-.87,1.179a1.448,1.448,0,0,0-.271.943,8.916,8.916,0,0,1-.487,3.586,6.346,6.346,0,0,1-1.7,2.524,7.524,7.524,0,0,1-3.566,1.724A10.979,10.979,0,0,1,5.794,12.711Zm0,0" transform="translate(0 -0.001)"></path></svg></a><a class="no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="https://forum.rescript-lang.org" rel="noopener noreferrer"><svg class="fill-current w-6 h-6 opacity-50 hover:opacity-100" viewBox="0 0 24 24"><path d="M12.103 0C18.666 0 24 5.485 24 11.997c0 6.51-5.33 11.99-11.9 11.99L0 24V11.79C0 5.28 5.532 0 12.103 0zm.116 4.563a7.395 7.395 0 00-6.337 3.57 7.247 7.247 0 00-.148 7.22L4.4 19.61l4.794-1.074a7.424 7.424 0 008.136-1.39 7.256 7.256 0 001.737-7.997 7.375 7.375 0 00-6.84-4.585h-.008z"></path></svg></a></div></div></div><button class="h-full px-4 xs:hidden flex items-center hover:text-white"><svg class="fill-current h-1 w-auto block text-gray-60" height="4" width="22" stroke="none" viewBox="0 0 22 4"><circle cx="2" cy="2" r="2"></circle><circle cx="2" cy="2" r="2" transform="translate(9)"></circle><circle cx="2" cy="2" r="2" transform="translate(18)"></circle></svg></button><div class="hidden sm:hidden flex-col fixed top-0 left-0 h-full w-full z-50 sm:w-9/12 bg-gray-100 sm:h-auto sm:flex sm:relative sm:flex-row sm:justify-between" style="min-width:20rem;top:4rem"><div class="border-gray-80 border-t"><ul><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><div class="opacity-75 hover:text-white hover:cursor-pointer bg-gray-80 flex items-center p-2 px-3 rounded"><svg class="stroke-current w-5 h-5 mr-3" height="19.203" width="19.203" viewBox="0 0 19.203 19.203"><g fill="none" stroke-linecap="round" stroke-width="2px" transform="translate(-2 -2)"><path d="M6.479,0A6.479,6.479,0,1,1,0,6.479,6.479,6.479,0,0,1,6.479,0Z" transform="translate(3 3)"></path><line stroke-linejoin="round" transform="translate(14.055 14.055)" x1="5.734" y1="5.734"></line></g></svg><input type="text" class="w-32 bg-gray-80 focus:outline-none " id="docsearch-mobile"/></div></li><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><a class="no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="/try">工作台</a></li><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><a class="no-underline block text-inherit hover:cursor-pointer hover:text-fire-30 text-gray-40 mb-px" href="/blog">Blog</a></li><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><a class="block hover:cursor-pointer hover:text-white text-gray-60" href="https://twitter.com/rescriptlang" rel="noopener noreferrer">Twitter</a></li><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><a class="block hover:cursor-pointer hover:text-white text-gray-60" href="https://github.com/reason-association/rescript-lang.org#rescript-langorg" rel="noopener noreferrer">GitHub</a></li><li class="font-normal mx-4 py-5 text-gray-20 border-b border-gray-80"><a class="block hover:cursor-pointer hover:text-white text-gray-60" href="https://forum.rescript-lang.org" rel="noopener noreferrer">Forum</a></li></ul></div></div></nav><div class="hidden z-40 bg-gray-10-tr w-full h-full bottom-0" style="backdrop-filter:blur(2px);-webkit-backdrop-filter:blur(2px)"></div><div class="flex xs:justify-center overflow-hidden pb-48"><main class="mt-16 min-w-320 lg:align-center w-full px-4 md:px-8 max-w-1280 "><div class="flex justify-center"><div class="max-w-740 w-full"><h1 class="hl-1 mb-6 ">构建自定义 Hooks</h1><div class="text-24 mt-8 mb-4"><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">React 自带了一些基础的 hooks，例如 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">React.useState</code> 或 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">React.useEffect</code>。本章中你将学习如何针对你的 React 用例构建高阶 hooks。</p></div><h2 class="group mt-16 mb-3 hl-3">为什么自定义 Hooks？<span class="ml-2"><span class="inline group relative"><a class="invisible text-gray-60 opacity-50 text-inherit hover:opacity-100 hover:text-gray-60 hover:cursor-pointer group-hover:visible" href="#为什么自定义-hooks？"><svg class="fill-current inline-block align-middle text-gray-40" height="0.8em" width="0.8em" viewBox="0 0 20.003 19.944"><path d="M11.927 7.908a4.819 4.819 0 00-3.968-1.3 5.091 5.091 0 00-2.921 1.508L1.47 11.684a4.82 4.82 0 00.192 7.122 4.994 4.994 0 006.76-.4l3.7-3.776a.109.109 0 00-.067-.184s-.649.029-1.132.006a10.116 10.116 0 01-1.35-.226.308.308 0 00-.243.088l-2.529 2.609a2.733 2.733 0 01-3.583.319 2.64 2.64 0 01-.247-3.951l3.755-3.753a2.7 2.7 0 013.654-.073.108.108 0 00.15 0l1.4-1.4a.114.114 0 00-.003-.157z"></path><path d="M8.076 12.036a4.822 4.822 0 003.967 1.3 5.089 5.089 0 002.922-1.509l3.568-3.568a4.818 4.818 0 00-.192-7.121 5 5 0 00-6.761.4l-3.7 3.777a.108.108 0 00.067.183s.648-.028 1.132-.006a10.151 10.151 0 011.35.226.3.3 0 00.243-.088l2.529-2.608a2.732 2.732 0 013.581-.319 2.638 2.638 0 01.249 3.95l-3.755 3.754a2.706 2.706 0 01-3.654.073.107.107 0 00-.15 0l-1.4 1.4a.113.113 0 00.004.156z"></path></svg></a><a id="为什么自定义-hooks？" style="position:absolute;top:-7rem"></a></span></span></h2><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">自定义 hooks 可以让你将现有组件的逻辑提取到可复用的，独立的函数中。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">我们回顾一下之前的例子 <a class="no-underline text-fire hover:underline" href="./hooks-effect" rel="noopener noreferrer">React.useEffect 章节</a>，这个例子中我们构建了一个聊天应用的组件，用于展示消息，显示朋友是否在线。</p><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=PTAEDECcEsFMDsAmBlALgQ1QVwM4DpJYcAoYgWwHtEsAbWUAYQAtMBBABQElQBeUAb2KhQIUIC-FQHFygFHtAXJ6AQt0B3bnMAw-8zZdA9GaAtMMAh5nMAAcoCo5QBaKgAR1AG8qB5xKGhUATwAO9HBmw5eA0NBwB5eDWh4WAAuUAAjCgoaUABfAG4bAAEAN3Ro2AAPVFhIeDTQHCwwnABjGDDYABUKKDgkNExcUIAKFxh4AHMAGgLXXF4APlAseGhUAEpB4dHUDwAiQuKy6Arq2oQUPpw5hOEU-Mzs3PyRxdLy2CgKMnX6rZa2wO7exvceIZGxyffpsfnTornFaXSDXW6bV47YgxUj2JwvbIeHwAM2RASCoAAPqAADIUdCIJ5Y0B+dGwBLERKEdAlVB4ErXBwUILwVDEOizMjoADW9D4zQAfsiYBtOIhQo9Ot8hoJhBzQK1XLAejhYKgGtlvqAAEqwGl03CwDWwZoAfSmKLRgVg41Iwl1+rwhoAoqjYLTms1pQIbHK1aAWEg6BrcGpOnyFS5Xt7ZcI46r1UqzVNY3H41s8GpUBxOHhvKTraAAPwk-yF0KWsm+uMxW1pmHVrM5vBnZarGoiu6vZrCuqIMU9QOIYNbMMdG27eNq43Jn54glPcYUtPykp0dDwLAODxelPV4RNrhO+Cti5XG6diFuHuXgcBjfDo2jwPjus1u1x5DXE1rvWbhxvrWH7ytkWQeDgADuYwlEwiqYDaPpptilaFj8vaiogoAANRYaAcxeO4FComSczVshZYYmht6YTheEEaAzIkWRuL4oSnRTHMNCsU8eC8aRwgNsIAA8hLJAM1b8A6tItqg7QdM0oETDCwnAKJ4kNkAA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="inline-block text-inherit opacity-50"><span class="hljs-comment">// FriendStatus.res</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">module</span> <span class="hljs-module-identifier">ChatAPI</span> = {</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-comment">// 出于演示的目的，ChatAPI是虚构的一个全局变量</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">type</span> status <span class="hljs-operator">=</span> <span class="hljs-literal">{</span> isOnline: bool };</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-attribute">@val</span> <span class="hljs-keyword">external</span> subscribeToFriendStatus: (string, status <span class="hljs-function">=&gt;</span> unit) <span class="hljs-function">=&gt;</span> unit <span class="hljs-operator">=</span> <span class="hljs-string">&quot;subscribeToFriendStatus&quot;</span>;</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-attribute">@val</span> <span class="hljs-keyword">external</span> unsubscribeFromFriendStatus: (string, status <span class="hljs-function">=&gt;</span> unit) <span class="hljs-function">=&gt;</span> unit <span class="hljs-operator">=</span> <span class="hljs-string">&quot;unsubscribeFromFriendStatus&quot;</span>;</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">type</span> state <span class="hljs-operator">=</span> <span class="hljs-constructor">Offline</span> | <span class="hljs-constructor">Loading</span> | <span class="hljs-constructor">Online</span>;</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-attribute">@react.component</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> make <span class="hljs-operator">=</span> (~friendId: string) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> (state, setState) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Offline</span>)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block">  <span class="hljs-module-identifier">React</span>.useEffect(() <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">    <span class="hljs-keyword">let</span> handleStatusChange <span class="hljs-operator">=</span> (status) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">      setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">        status.<span class="hljs-module-identifier">ChatAPI</span>.isOnline ? <span class="hljs-constructor">Online</span> : <span class="hljs-constructor">Offline</span></span>
<span class="inline-block">      <span class="hljs-literal">}</span>)</span>
<span class="inline-block">    <span class="hljs-literal">}</span></span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-module-identifier">ChatAPI</span>.subscribeToFriendStatus(friendId, handleStatusChange);</span>
<span class="inline-block">    setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Loading</span>);</span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-keyword">let</span> cleanup <span class="hljs-operator">=</span> () <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">      <span class="hljs-module-identifier">ChatAPI</span>.unsubscribeFromFriendStatus(friendId, handleStatusChange)</span>
<span class="inline-block">    <span class="hljs-literal">}</span></span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-constructor">Some</span>(cleanup)</span>
<span class="inline-block">  <span class="hljs-literal">}</span>)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> text <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span>(state) <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Offline</span> <span class="hljs-function">=&gt;</span> friendId <span class="hljs-operator">++</span> <span class="hljs-string">&quot; is offline&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Online</span> <span class="hljs-function">=&gt;</span> friendId <span class="hljs-operator">++</span> <span class="hljs-string">&quot; is online&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Loading</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;loading...&quot;</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  &lt;div&gt;</span>
<span class="inline-block text-inherit opacity-50">    <span class="hljs-literal">{</span><span class="hljs-module-identifier">React</span>.string(text)<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50">  &lt;/div&gt;</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"></span></code></pre></div></div></div><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">现在，假设我们的聊天应用有个联系人列表，我们想用绿色展示在线用户的名字。我们可以复制粘贴上面相似的逻辑到 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendListItem</code> 组件中，但这并不令人满意。</p><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=PTAEDECcEsFMDsAmAZaBnALgSQ7AtgHSSxoBQGAngA6yiYCGuoAvKAPIBmHANtPLQB9QyAPb1EfAOaghbeL34BuUqRCg8IxAFdutAMIALRgEEAClhagA3gVsBfFZRqgOMBIktXSoUNEQAuOgwYeEkAGm9QeHo8WEDMEMlSO2VSAAFiegBjDAIskTwqEX54DFJdDHV6AGtaVgAKAD9XOCRAlvcAShYAPmtIitB6hlwwulgMAGUMRlhu1gAlWGzcrTRYadn6gH1e9i4FOZUfJZWCNdgAUS5YHPr6+b6vHx9BoyRdTYw1w3pQuqGIzWj36Lxe6ymM1wOz2zzB4KhawIvwwZiwBHQckOoAA-Ox5HxaIFODxCZEwXZOuTQA5qSi0QQ0FoAEZoLIwZmwAAqIigrUQXzW9Q6SAxiDG70Qn0RaF+-06yjBEK+sBhzD6onEUgVxxegyyuj+WiolgesOpPnp5nO8CZrPZ0E5UAKfPcgrQwrcor8Er+Uo2MrlkiOFN1PkmBVVBuW8GNVJ8lN1+pE3BEkEsaAA7tAMFkDMMoXNQS9ZAdCXsAETERAV6myAn8SuSYgIWtgoSaiShJvEChtmm6gA8vCCFF0zCspxyABE2ABZaZj2AEPA1VWNfKpyBhB6dOw9C3WKe5BJST38gjRWJ7yKD4C8A8OIA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="inline-block text-inherit opacity-50"><span class="hljs-comment">// FriendListItem.res</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">type</span> state <span class="hljs-operator">=</span> <span class="hljs-constructor">Offline</span> | <span class="hljs-constructor">Loading</span> | <span class="hljs-constructor">Online</span>;</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-comment">// module ChatAPI = {...}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">type</span> friend <span class="hljs-operator">=</span> <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">  id: string,</span>
<span class="inline-block text-inherit opacity-50">  name: string</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span>;</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-attribute">@react.component</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> make <span class="hljs-operator">=</span> (~friend: friend) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> (state, setState) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Offline</span>)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block">  <span class="hljs-module-identifier">React</span>.useEffect(() <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">    <span class="hljs-keyword">let</span> handleStatusChange <span class="hljs-operator">=</span> (status) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">      setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">        status.<span class="hljs-module-identifier">ChatAPI</span>.isOnline ? <span class="hljs-constructor">Online</span> : <span class="hljs-constructor">Offline</span></span>
<span class="inline-block">      <span class="hljs-literal">}</span>)</span>
<span class="inline-block">    <span class="hljs-literal">}</span></span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-module-identifier">ChatAPI</span>.subscribeToFriendStatus(friend.id, handleStatusChange);</span>
<span class="inline-block">    setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Loading</span>);</span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-keyword">let</span> cleanup <span class="hljs-operator">=</span> () <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">      <span class="hljs-module-identifier">ChatAPI</span>.unsubscribeFromFriendStatus(friend.id, handleStatusChange)</span>
<span class="inline-block">    <span class="hljs-literal">}</span></span>
<span class="inline-block">&nbsp;</span>
<span class="inline-block">    <span class="hljs-constructor">Some</span>(cleanup)</span>
<span class="inline-block">  <span class="hljs-literal">}</span>)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> color <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span>(state) <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Offline</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;red&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Online</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;green&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Loading</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;grey&quot;</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  &lt;li style<span class="hljs-operator">=</span><span class="hljs-literal">{</span><span class="hljs-module-identifier">ReactDOMStyle</span>.make(~color,())<span class="hljs-literal">}</span>&gt;</span>
<span class="inline-block text-inherit opacity-50">      <span class="hljs-literal">{</span><span class="hljs-module-identifier">React</span>.string(friend.name)<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50">  &lt;/li&gt;</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span></code></pre></div></div></div><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">相反，我们更期望这段逻辑能在 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendStatus</code> 和 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendListItem</code> 中共用</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">传统上，在 React 中有两种流行的方法来在组件间共享有状态的逻辑：<code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">render props</code> 和高阶组件。现在让我们看看 Hooks 是如何解决大多数同类的问题，而不需要在组件树中添加更多组件的。</p><h2 class="group mt-16 mb-3 hl-3">提取自定义 Hook<span class="ml-2"><span class="inline group relative"><a class="invisible text-gray-60 opacity-50 text-inherit hover:opacity-100 hover:text-gray-60 hover:cursor-pointer group-hover:visible" href="#提取自定义-hook"><svg class="fill-current inline-block align-middle text-gray-40" height="0.8em" width="0.8em" viewBox="0 0 20.003 19.944"><path d="M11.927 7.908a4.819 4.819 0 00-3.968-1.3 5.091 5.091 0 00-2.921 1.508L1.47 11.684a4.82 4.82 0 00.192 7.122 4.994 4.994 0 006.76-.4l3.7-3.776a.109.109 0 00-.067-.184s-.649.029-1.132.006a10.116 10.116 0 01-1.35-.226.308.308 0 00-.243.088l-2.529 2.609a2.733 2.733 0 01-3.583.319 2.64 2.64 0 01-.247-3.951l3.755-3.753a2.7 2.7 0 013.654-.073.108.108 0 00.15 0l1.4-1.4a.114.114 0 00-.003-.157z"></path><path d="M8.076 12.036a4.822 4.822 0 003.967 1.3 5.089 5.089 0 002.922-1.509l3.568-3.568a4.818 4.818 0 00-.192-7.121 5 5 0 00-6.761.4l-3.7 3.777a.108.108 0 00.067.183s.648-.028 1.132-.006a10.151 10.151 0 011.35.226.3.3 0 00.243-.088l2.529-2.608a2.732 2.732 0 013.581-.319 2.638 2.638 0 01.249 3.95l-3.755 3.754a2.706 2.706 0 01-3.654.073.107.107 0 00-.15 0l-1.4 1.4a.113.113 0 00.004.156z"></path></svg></a><a id="提取自定义-hook" style="position:absolute;top:-7rem"></a></span></span></h2><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">我们需要在函数之间共享逻辑时，通常会将逻辑提取到另一个函数中。组件和 Hooks 都是函数，所以这个思路也适用。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16"><strong class="font-semibold">自定义 Hook 是以 ”use” 作为前缀的函数，同时也可能会调用其它的 Hooks。</strong>举例来说，下面的 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useFriendStatus</code> 是我们的第一个 Hook（我们新创建了 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendStatusHook.res</code> 文件，用来封装 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">state</code> 类型）：</p><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=PTAEDECcEsFMDsAmBlALgQ1QVwM4AkB7AgawDpJYcAoKkUAWwMSwBtZQBhAC0wEEAFAJKgA3qXEBfGqgCeAB3Y4MqdgF5QAeQBmWltHjsAPqAAyBdIn0BzUMY3w9Bmm1ShcsKHCRpMuUOoAKLRgEREFEAC5QJRh4KwBKKKVMNQA+USpQUBdQAOSVABpo2FQfFXj-UAAlWHQAY1RSdzLYAIB9f3TtXX1YeJosmvrG9wBRHVgGgICK1XSRTKzsktAeJDYy3G50OLVo5T85jKWlnBKW9s7jk9ODnFJt1AFBUmgce0d2AH5NB17QKLdT6LE4SfqggZLR7PUg4LAAIxwdRg8NgABUCJ5QpscEEQkhwkU1ogNndtrtwadzspWh0jmYLNZ+iDlq46mwdlg5JUZlcFjdODwnkImvA4YjkdBUVACPQsd47nivGFEESdiTYDjyVY+iypCzkLLWuzavAuZSwZD8rAqFIgA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="hljs-comment">// FriendStatusHook.res</span>

<span class="hljs-comment">// module ChatAPI {...}</span>

<span class="hljs-keyword">type</span> state <span class="hljs-operator">=</span> <span class="hljs-constructor">Offline</span> | <span class="hljs-constructor">Loading</span> | <span class="hljs-constructor">Online</span>

<span class="hljs-keyword">let</span> useFriendStatus <span class="hljs-operator">=</span> (friendId: string): state <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span>
  <span class="hljs-keyword">let</span> (state, setState) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Offline</span>)

  <span class="hljs-module-identifier">React</span>.useEffect(() <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span>
    <span class="hljs-keyword">let</span> handleStatusChange <span class="hljs-operator">=</span> status <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span>
      setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span>
        status.<span class="hljs-module-identifier">ChatAPI</span>.isOnline ? <span class="hljs-constructor">Online</span> : <span class="hljs-constructor">Offline</span>
      <span class="hljs-literal">}</span>)
    <span class="hljs-literal">}</span>

    <span class="hljs-module-identifier">ChatAPI</span>.subscribeToFriendStatus(friendId, handleStatusChange)
    setState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Loading</span>)

    <span class="hljs-keyword">let</span> cleanup <span class="hljs-operator">=</span> () <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span>
      <span class="hljs-module-identifier">ChatAPI</span>.unsubscribeFromFriendStatus(friendId, handleStatusChange)
    <span class="hljs-literal">}</span>

    <span class="hljs-constructor">Some</span>(cleanup)
  <span class="hljs-literal">}</span>)

  state
<span class="hljs-literal">}</span>
</code></pre></div></div></div><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">里面没啥新的内容，逻辑都是从上面组件中复制过来的。就像在组件中一样，确保只在自定义 Hook 的顶层无条件地调用其他 Hook。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">与 React 组件不同，自定义 Hook 不需要具有特定签名。 我们可以决定它接受什么作为参数，以及它应该返回什么（如果有的话）。换句话说，它就像一个普通的函数。它的名称应该始终以 use 开头，以便你一眼就可以看出它是 Hooks。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">我们的 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useFriendStatus</code> Hook 的用途是订阅朋友的状态。所以它将 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">friendId</code> 作为参数，并返回在线状态，如 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">Online</code>、<code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">Offline</code> 或 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">Loading</code>：</p><pre class="mt-2 mb-4 -mx-6 xs:mx-0 block"><div class="md-code font-mono w-full block mt-5 mb-5"><div class="relative w-full flex-col rounded-none xs:rounded border-t border-b xs:border border-gray-20 bg-gray-10 py-2 text-gray-80"><div class="absolute right-0 px-4 pb-4 font-sans text-12 font-bold text-gray-30">RES</div><div class="px-5 text-14 pt-4 pb-2 overflow-x-auto -mt-2"><code class="hljs lang-res "><span class="hljs-keyword">let</span> useFriendStatus <span class="hljs-operator">=</span> (friendId: string): status <span class="hljs-literal">{</span>
  <span class="hljs-keyword">let</span> (state, setState) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Offline</span>);

  <span class="hljs-comment">// ...</span>

  state
<span class="hljs-literal">}</span>
</code></div></div></div></pre><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">现在用一下我们的自定义 Hook。</p><h2 class="group mt-16 mb-3 hl-3">使用自定义 Hook<span class="ml-2"><span class="inline group relative"><a class="invisible text-gray-60 opacity-50 text-inherit hover:opacity-100 hover:text-gray-60 hover:cursor-pointer group-hover:visible" href="#使用自定义-hook"><svg class="fill-current inline-block align-middle text-gray-40" height="0.8em" width="0.8em" viewBox="0 0 20.003 19.944"><path d="M11.927 7.908a4.819 4.819 0 00-3.968-1.3 5.091 5.091 0 00-2.921 1.508L1.47 11.684a4.82 4.82 0 00.192 7.122 4.994 4.994 0 006.76-.4l3.7-3.776a.109.109 0 00-.067-.184s-.649.029-1.132.006a10.116 10.116 0 01-1.35-.226.308.308 0 00-.243.088l-2.529 2.609a2.733 2.733 0 01-3.583.319 2.64 2.64 0 01-.247-3.951l3.755-3.753a2.7 2.7 0 013.654-.073.108.108 0 00.15 0l1.4-1.4a.114.114 0 00-.003-.157z"></path><path d="M8.076 12.036a4.822 4.822 0 003.967 1.3 5.089 5.089 0 002.922-1.509l3.568-3.568a4.818 4.818 0 00-.192-7.121 5 5 0 00-6.761.4l-3.7 3.777a.108.108 0 00.067.183s.648-.028 1.132-.006a10.151 10.151 0 011.35.226.3.3 0 00.243-.088l2.529-2.608a2.732 2.732 0 013.581-.319 2.638 2.638 0 01.249 3.95l-3.755 3.754a2.706 2.706 0 01-3.654.073.107.107 0 00-.15 0l-1.4 1.4a.113.113 0 00.004.156z"></path></svg></a><a id="使用自定义-hook" style="position:absolute;top:-7rem"></a></span></span></h2><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">最开始我们的既定目标是移除 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendStatus</code> 和 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendListItem</code> 组件的重复逻辑。这两个组件都需要知道朋友的在线状态。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">现在我们已经将这个逻辑提取到 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useFriendStatus</code> hook 中，我们可以直接使用它：</p><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=PTAEDECcEsFMDsAmBlALgQ1QVwM4DpJYcAoVATwAdZQAzGBRUAXlAG9RpEAuUHVGeAHNQAXwDcxYgAFC6AMao8cgPYBbCsvgJUxADaxUoVegDW1FgAoAfnThIethgEpmAPjbFQofYc27oWmiY5hD0SEHYOAASysomeLiwUHYoGJEWjkh4nE4Snt4GvGm4zLwA7tCocgAWFn4BsBGwLqz5XgA+oSkRuDFxeADy8P5abqAAREMjsONtoJ0AMsroiAHCTO7jSytrs14doAM0NNNjk8fTe6KSXgBKsPKKfAKCFnyYuLnEIsRAA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="inline-block text-inherit opacity-50"><span class="hljs-comment">// FriendStatus.res</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">type</span> friend <span class="hljs-operator">=</span> <span class="hljs-literal">{</span> id: string <span class="hljs-literal">}</span>;</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-attribute">@react.component</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> make <span class="hljs-operator">=</span> (~friend: friend) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">  <span class="hljs-keyword">let</span> onlineState <span class="hljs-operator">=</span> <span class="hljs-module-identifier">FriendStatusHook</span>.useFriendStatus(friend.id);</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> status <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span>(onlineState) <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-module-identifier">FriendStatusHook</span>.<span class="hljs-constructor">Online</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;Online&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Loading</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;Loading&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Offline</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;Offline&quot;</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-module-identifier">React</span>.string(status);</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span></code></pre></div></div></div><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=PTAEDECcEsFMDsAmAZaBnALgSQ7AtgHSSxoBQAAsQIYDGGBNA9ngA6PwIakA2sGoeKgGtYoALygAFAD8AZjASIAXKHlwkASnEA+UAG9SoUL37tu0DgGUMVXOIgKk12wFc0ACUaMhBN7CjqiM4YbpJqigTQiBoA3KSGxnygTNyMkPZoAO7QGDQAFpJmFrDBsFoGRkYAPqAA8rKy5hw6oABExIitCdV18E2iYrqtAObECF2VoDXIjFSIFsMtI8QAnhOgAL7xRgA85qCYK7xiegBKsLQYACK1ALLWR7AEgiIyKWkANJIaGhva3ZUzhc6ARMDB4MMwo5EAR4FQ8GUtrtgOZ-lsgA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="inline-block text-inherit opacity-50"><span class="hljs-comment">// FriendListItem.res</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-attribute">@react.component</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> make <span class="hljs-operator">=</span> (~friend: friend) <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">  <span class="hljs-keyword">let</span> onlineState <span class="hljs-operator">=</span> <span class="hljs-module-identifier">FriendStatusHook</span>.useFriendStatus(friend.id);</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> color <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span>(onlineState) <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Offline</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;red&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Online</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;green&quot;</span></span>
<span class="inline-block text-inherit opacity-50">    | <span class="hljs-constructor">Loading</span> <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;grey&quot;</span></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  &lt;li style<span class="hljs-operator">=</span><span class="hljs-literal">{</span><span class="hljs-module-identifier">ReactDOMStyle</span>.make(~color,())<span class="hljs-literal">}</span>&gt;</span>
<span class="inline-block text-inherit opacity-50">      <span class="hljs-literal">{</span><span class="hljs-module-identifier">React</span>.string(friend.name)<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50">  &lt;/li&gt;</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span></code></pre></div></div></div><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16"><strong class="font-semibold">这个代码和之前的例子是等价的吗？</strong>是的，它会以相同的方式工作。如果你仔细观察，你会注意到我们没有更改任何行为。我们只是将两个函数之间的一些公共代码提取到一个单独的函数中。自定义 Hooks 是一个约定，自然遵循 Hooks 的设计，而不是一个 React 特性。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16"><strong class="font-semibold">我的自定义 Hooks 必须以 “use” 开头吗？</strong>请这样做吧。这个约定非常重要。没有它，我们就无法自动检查是否违反 Hooks 规则，因为我们无法判断某个函数内部是否包含对 Hooks 的调用。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16"><strong class="font-semibold">使用相同 Hook 的两个组件共享状态吗？</strong>不。自定义Hook是一种复用状态逻辑的机制（例如设置订阅并记住当前值），但是每次使用自定义 Hook 时，其中的所有状态和效果都是完全隔离的。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16"><strong class="font-semibold">自定义 Hook 是如何隔离状态的？</strong>对 Hook 的每次调用都会获得隔离的状态。因为我们直接调用 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useFriendStatus</code>，从 React 的角度来看，我们的组件只调用了 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useState</code> 和 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useEffect</code>。而且正如我们之前所了解的，我们可以在一个组件中多次调用 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useState</code> 和 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useEffect</code>，它们将是完全独立的。</p><h3 class="group mt-8 mb-1 hl-4">技巧：在 Hooks 之间传递信息<span class="ml-2"><span class="inline group relative"><a class="invisible text-gray-60 opacity-50 text-inherit hover:opacity-100 hover:text-gray-60 hover:cursor-pointer group-hover:visible" href="#技巧：在-hooks-之间传递信息"><svg class="fill-current inline-block align-middle text-gray-40" height="0.8em" width="0.8em" viewBox="0 0 20.003 19.944"><path d="M11.927 7.908a4.819 4.819 0 00-3.968-1.3 5.091 5.091 0 00-2.921 1.508L1.47 11.684a4.82 4.82 0 00.192 7.122 4.994 4.994 0 006.76-.4l3.7-3.776a.109.109 0 00-.067-.184s-.649.029-1.132.006a10.116 10.116 0 01-1.35-.226.308.308 0 00-.243.088l-2.529 2.609a2.733 2.733 0 01-3.583.319 2.64 2.64 0 01-.247-3.951l3.755-3.753a2.7 2.7 0 013.654-.073.108.108 0 00.15 0l1.4-1.4a.114.114 0 00-.003-.157z"></path><path d="M8.076 12.036a4.822 4.822 0 003.967 1.3 5.089 5.089 0 002.922-1.509l3.568-3.568a4.818 4.818 0 00-.192-7.121 5 5 0 00-6.761.4l-3.7 3.777a.108.108 0 00.067.183s.648-.028 1.132-.006a10.151 10.151 0 011.35.226.3.3 0 00.243-.088l2.529-2.608a2.732 2.732 0 013.581-.319 2.638 2.638 0 01.249 3.95l-3.755 3.754a2.706 2.706 0 01-3.654.073.107.107 0 00-.15 0l-1.4 1.4a.113.113 0 00.004.156z"></path></svg></a><a id="技巧：在-hooks-之间传递信息" style="position:absolute;top:-7rem"></a></span></span></h3><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">由于 Hooks 是函数，我们可以直接在它们间传递信息。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">为了演示这一点，我们将使用聊天示例中的另一个组件。这是一个消息收件人选择器，显示当前选择的朋友是否在线：</p><div class="md-codetab mt-8 mb-8 -mx-6 xs:mx-0"><div class="relative pt-6 w-full rounded-none text-gray-80"><div class="absolute flex w-full font-sans bg-transparent text-14 text-gray-40 " style="margin-top:-26px"><div class="flex ml-2 xs:ml-0"><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 text-gray-40 bg-gray-5 border-t-2 first:border-l" style="border-color:#696B7D #EDF0F2">ReScript</span><span class="sm:px-4 flex-none px-5 inline-block p-1 first:rounded-tl font-medium text-12 hover:text-gray-60 border-t-2 bg-gray-20 hover:cursor-pointer" style="border-color:transparent">JS Output</span></div><div class="flex-1 w-full bg-gray-20 border-b rounded-tr border-gray-20 items-center"><div class="flex items-center justify-end h-full pr-4 space-x-2"><a target="_blank" href="/try?code=C4TwDgpgBAZgTgSwgOwCZQLxQN4NQLigGdhFkBzAGimQEMBbCQks8gXwCgOAbCYWRClQAZBCUxQA2hyg48hAEQBGBdTqNFABQAWAewgAjCAraUZcglAUAmVTQZMrAJVoBjbRG4mzs3JYUAzHbqjgpOukRE3hwAulwAAnAQbsAAdK669GC6yCjAPHxQ9LQA1tBYABQAlJgAfDjmvPwVSa4IYEjIwACSqNREfE4QbR15vTVYQympAK4DAMrAtMAQFQD6dVYqVY2Fre2dwADyyNwIuYvL5VAAYoJol8BzABK6uiWzA3edqI9zLcMDmNUDtdvwMtxdHAJEQAO4IYDuKD7UZdE5nC5LFYNWQAH1u91+WJebw+RxgMAx5XqAGEEHBXLxUkNUOZ8ejztSoABxJIoNlQYS6Wioc7kTa8iAgcycMFQHI07S0CjXCAAN34GHq2HMsiaUDVtG4M2uU1cwAAomq8qkblD6KklnByHwKurgFVJApDcbjHFZLIBsAhiNDr0Kj6TTtZLK9YV4D8iBIAEKeNIAQTgcFoIFSxTAFQTQlEJGoRbQmx1AagAB5dGBgAgclAyiAMNhy6hUng2AajSb253u6g2LVdQHsGa0iwxYXCakQlVONWawB6euNnJjmOg2Q17cBmt0hm8KAQqFQVcHvcDXjmvu+9sosMj+XIRXKl3XidT1K0LM5nOiZLuOa63sMwAHmuY6cEAA}"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3"></path></svg></a><button class="relative"><svg class="stroke-current text-gray-30 mt-px hover:cursor-pointer hover:text-gray-60 hover:bg-gray-30 w-6 h-6 p-1 rounded transition-all duration-300 ease-in-out" height="16" width="16" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"></path><rect height="4" width="8" rx="1" ry="1" x="8" y="2"></rect></svg></button></div></div></div><div class="px-4 lg:px-5 text-14 pb-4 pt-4 overflow-x-auto bg-gray-10 border-gray-20 xs:rounded-b border"><pre><code class="hljs lang-res "><span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">type</span> friend <span class="hljs-operator">=</span> <span class="hljs-literal">{</span>id: string, name: string<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> friendList <span class="hljs-operator">=</span> [</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">{</span>id: <span class="hljs-string">&quot;1&quot;</span>, name: <span class="hljs-string">&quot;Phoebe&quot;</span><span class="hljs-literal">}</span>,</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">{</span>id: <span class="hljs-string">&quot;2&quot;</span>, name: <span class="hljs-string">&quot;Rachel&quot;</span><span class="hljs-literal">}</span>,</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">{</span>id: <span class="hljs-string">&quot;3&quot;</span>, name: <span class="hljs-string">&quot;Ross&quot;</span><span class="hljs-literal">}</span>,</span>
<span class="inline-block text-inherit opacity-50">]</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-attribute">@react.component</span></span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-keyword">let</span> make <span class="hljs-operator">=</span> () <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block">  <span class="hljs-keyword">let</span> (recipientId, setRecipientId) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;1&quot;</span>)</span>
<span class="inline-block">  <span class="hljs-keyword">let</span> recipientOnlineState <span class="hljs-operator">=</span> <span class="hljs-module-identifier">FriendStatusHook</span>.useFriendStatus(recipientId)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block">  <span class="hljs-keyword">let</span> color <span class="hljs-operator">=</span> <span class="hljs-keyword">switch</span> recipientOnlineState <span class="hljs-literal">{</span></span>
<span class="inline-block">  | <span class="hljs-module-identifier">FriendStatusHook</span>.<span class="hljs-constructor">Offline</span> <span class="hljs-function">=&gt;</span> <span class="hljs-module-identifier">Circle</span>.<span class="hljs-constructor">Red</span></span>
<span class="inline-block">  | <span class="hljs-constructor">Online</span> <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Green</span></span>
<span class="inline-block">  | <span class="hljs-constructor">Loading</span> <span class="hljs-function">=&gt;</span> <span class="hljs-constructor">Grey</span></span>
<span class="inline-block">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> onChange <span class="hljs-operator">=</span> evt <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    <span class="hljs-keyword">let</span> value <span class="hljs-operator">=</span> <span class="hljs-module-identifier">ReactEvent</span>.<span class="hljs-module-identifier">Form</span>.target(evt)[<span class="hljs-string">&quot;value&quot;</span>]</span>
<span class="inline-block">    setRecipientId(value)</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-keyword">let</span> friends <span class="hljs-operator">=</span> <span class="hljs-module-identifier">Belt</span>.<span class="hljs-module-identifier">Array</span>.map(friendList, friend <span class="hljs-function">=&gt;</span> <span class="hljs-literal">{</span></span>
<span class="inline-block text-inherit opacity-50">    &lt;option key<span class="hljs-operator">=</span><span class="hljs-literal">{</span>friend.id<span class="hljs-literal">}</span> value<span class="hljs-operator">=</span><span class="hljs-literal">{</span>friend.id<span class="hljs-literal">}</span>&gt;</span>
<span class="inline-block text-inherit opacity-50">      <span class="hljs-literal">{</span><span class="hljs-module-identifier">React</span>.string(friend.name)<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50">    &lt;/option&gt;</span>
<span class="inline-block text-inherit opacity-50">  <span class="hljs-literal">}</span>)</span>
<span class="inline-block text-inherit opacity-50"></span>
<span class="inline-block text-inherit opacity-50">  &lt;&gt;</span>
<span class="inline-block text-inherit opacity-50">    &lt;<span class="hljs-module-identifier">Circle</span> color /&gt;</span>
<span class="inline-block text-inherit opacity-50">    &lt;select value<span class="hljs-operator">=</span><span class="hljs-literal">{</span>recipientId<span class="hljs-literal">}</span> onChange&gt;</span>
<span class="inline-block text-inherit opacity-50">      <span class="hljs-literal">{</span><span class="hljs-module-identifier">React</span>.array(friends)<span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50">    &lt;/select&gt;</span>
<span class="inline-block text-inherit opacity-50">  &lt;/&gt;</span>
<span class="inline-block text-inherit opacity-50"><span class="hljs-literal">}</span></span>
<span class="inline-block text-inherit opacity-50"></span></code></pre></div></div></div><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">我们将当前选择的朋友 ID 保存在 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">recipientId</code> 状态变量中，如果用户在 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">&lt;select&gt;</code> 选择器中选择了不同的朋友，则更新它。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">因为 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">useState</code> Hook 调用为我们提供了 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">recipientId</code> 状态变量的最新值，我们可以将它作为参数传递给我们的自定义 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendStatusHook.useFriendStatus</code> Hook：</p><pre class="mt-2 mb-4 -mx-6 xs:mx-0 block"><div class="md-code font-mono w-full block mt-5 mb-5"><div class="relative w-full flex-col rounded-none xs:rounded border-t border-b xs:border border-gray-20 bg-gray-10 py-2 text-gray-80"><div class="absolute right-0 px-4 pb-4 font-sans text-12 font-bold text-gray-30">RES</div><div class="px-5 text-14 pt-4 pb-2 overflow-x-auto -mt-2"><code class="hljs lang-res "><span class="hljs-keyword">let</span> (recipientId, setRecipientId) <span class="hljs-operator">=</span> <span class="hljs-module-identifier">React</span>.useState(_ <span class="hljs-function">=&gt;</span> <span class="hljs-string">&quot;1&quot;</span>)
<span class="hljs-keyword">let</span> recipientOnlineState <span class="hljs-operator">=</span> <span class="hljs-module-identifier">FriendStatusHook</span>.useFriendStatus(recipientId)
</code></div></div></div></pre><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">这样我们能知道当前选择的朋友是否在线。如果我们选择不同的朋友并更新 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">recipientId</code> 状态变量，我们的 <code class="md-inline-code px-2 py-0.5 text-14 text-gray-60 font-mono rounded-sm bg-gray-10-tr border border-gray-90 border-opacity-5">FriendStatus.useFriendStatus</code> Hook将取消订阅之前选择的朋友，并订阅新选择的朋友的状态。</p><h2 class="group mt-16 mb-3 hl-3">发挥你的想象力<span class="ml-2"><span class="inline group relative"><a class="invisible text-gray-60 opacity-50 text-inherit hover:opacity-100 hover:text-gray-60 hover:cursor-pointer group-hover:visible" href="#发挥你的想象力"><svg class="fill-current inline-block align-middle text-gray-40" height="0.8em" width="0.8em" viewBox="0 0 20.003 19.944"><path d="M11.927 7.908a4.819 4.819 0 00-3.968-1.3 5.091 5.091 0 00-2.921 1.508L1.47 11.684a4.82 4.82 0 00.192 7.122 4.994 4.994 0 006.76-.4l3.7-3.776a.109.109 0 00-.067-.184s-.649.029-1.132.006a10.116 10.116 0 01-1.35-.226.308.308 0 00-.243.088l-2.529 2.609a2.733 2.733 0 01-3.583.319 2.64 2.64 0 01-.247-3.951l3.755-3.753a2.7 2.7 0 013.654-.073.108.108 0 00.15 0l1.4-1.4a.114.114 0 00-.003-.157z"></path><path d="M8.076 12.036a4.822 4.822 0 003.967 1.3 5.089 5.089 0 002.922-1.509l3.568-3.568a4.818 4.818 0 00-.192-7.121 5 5 0 00-6.761.4l-3.7 3.777a.108.108 0 00.067.183s.648-.028 1.132-.006a10.151 10.151 0 011.35.226.3.3 0 00.243-.088l2.529-2.608a2.732 2.732 0 013.581-.319 2.638 2.638 0 01.249 3.95l-3.755 3.754a2.706 2.706 0 01-3.654.073.107.107 0 00-.15 0l-1.4 1.4a.113.113 0 00.004.156z"></path></svg></a><a id="发挥你的想象力" style="position:absolute;top:-7rem"></a></span></span></h2><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">自定义 Hooks 提供了共享逻辑的灵活性。你可以编写自定义 Hook 去覆盖广泛的用例，例如表单处理、动画、声明式订阅、计时器，以及更多我们没有考虑到的用例。更重要的是，你可以构建与 React 的内置功能一样易于使用的 Hooks。</p><p class="md-p md:leading-5 tracking-[-0.015em] text-gray-80 md:text-16">尽量避免过早地添加抽象。当涉及到足够多的状态逻辑处理时，组件通常会变得很臃肿。这很正常，不要觉得必须立即将其拆分为 Hooks。但我们也鼓励你去发现自定义 Hook 的应用场景，它可以将复杂逻辑隐藏在简单的接口后面或帮助你解耦杂乱的组件。</p></div></div></main></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/docs-ko/react/latest/hooks-custom","query":{},"buildId":"57i003GrurB9OA8mdo-dW","runtimeConfig":{},"nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/_next/static/chunks/polyfills-9def993fe817cc057038.js"></script><script src="/_next/static/chunks/webpack-c49b9de92a7202ac2146.js" async=""></script><script src="/_next/static/chunks/framework-23118dcc1b886e5b49be.js" async=""></script><script src="/_next/static/chunks/main-82e7c4d3c08582bd58e0.js" async=""></script><script src="/_next/static/chunks/pages/_app-9e9d9ab67b4ceb7ec93b.js" async=""></script><script src="/_next/static/chunks/pages/docs-ko/react/latest/hooks-custom-06c465761882a020ea13.js" async=""></script><script src="/_next/static/57i003GrurB9OA8mdo-dW/_buildManifest.js" async=""></script><script src="/_next/static/57i003GrurB9OA8mdo-dW/_ssgManifest.js" async=""></script><script async="" defer="" src="https://scripts.simpleanalyticscdn.com/latest.js"></script><noscript><img src="https://queue.simpleanalyticscdn.com/noscript.gif" alt=""/></noscript></body></html>